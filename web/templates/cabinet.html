{% extends "base.html" %}
{% block content %}
<div class="canal">
  <div class="solid">
    {% if usr.avatar_url() %}
      <div class="solid_ava"><img class="solid_ava__img" src=" {{ usr.avatar_url() }}"></div>
    {% endif %}
    <div class="solid_txt">
      <h1>{{ usr.name }}</h1>
      <div class="solid_txt__info">
        {{ usr.channel_info }}
      </div>
    </div>
    <div class="tabs">
      <div class="tabs_tab tabs_tab__open tabs_tab__edge" onclick="func(this)">Главная</div>
      <div class="tabs_tab" onclick="func(this)">Видео пользователя</div>
      {% if settings %}
        <div class="tabs_tab" onclick="func(this)">Настройки</div>
      {% endif %}
    </div>
  </div>

  <div class="section section__open">
    {% if last %}
    <h2>Последние видео</h2>
    {%endif%}
    {% for item in last|reverse %}
      <div class="video">
        <a href="{{ url_for('play', vid=item.id) }}">
          <img src="{{url_for('get_image', pid=item.id)}}" alt="" class="video__preview">
        </a>
        <div class="video_txt">
          <a href="{{ url_for('play', vid=item.id) }}">
            <p class="video__title" title="{{item.title}}">{{item.title}}</p>
          </a>
          <a href="/cabinet/{{ item.user_login }}"><p class="video__ath">{{ item.user_login }}</p></a>
          <p class="video__views">{{ item.viewers | length }} просмотров</p>
        </div>
      </div>
    {% endfor %}
  </div>

  <div class="section">
    {% for item in items|reverse %}
    <div class="video">
      <a href="{{ url_for('play', vid=item.id) }}">
        <img src="{{url_for('get_image', pid=item.id)}}" alt="" class="video__preview">
      </a>
      <div class="video_txt">
        <a href="{{ url_for('play', vid=item.id) }}">
          <p class="video__title" title="{{item.title}}">{{item.title}}</p>
        </a>
        <a href="/cabinet/{{ item.user_login }}"><p class="video__ath">{{ item.user_login }}</p></a>
        <p class="video__views">{{ item.viewers | length }} просмотров</p>
      </div>
    </div>
    {% endfor %}
  </div>

  {% if settings %}
    <div class="section settings">
      <h3>Личные данные</h3>
      <form action="" method="post" enctype="multipart/form-data" >
        {{form.hidden_tag()}}
        <div class="settings_set">
          {{ form.change_name.label }}
          <br>
          {{ form.change_name }}
          {% if form.change_name.errors %}
            {% for error in form.change_name.errors %}
              <div style="color: red;">{{ error }}</div>
            {% endfor %}
          {% endif %}
        </div>

        <div class="settings_set">
          {{ form.change_password.label }}
          <br>
          {{ form.change_password }}
          {% if form.change_password.errors %}
            {% for error in form.change_password.errors %}
              <div style="color: red;">{{ error }}</div>
            {% endfor %}
          {% endif %}
        </div>
        <div clss="settings_set">
          {{ form.channel_info.label }}
          <br>
          {{ form.channel_info }}
          {% if form.channel_info.errors %}
            {% for error in form.channel_info.errors %}
              <div style="color: red;">{{ error }}</div>
            {% endfor %}
          {% endif %}
        </div>

        <hr>
        <h3>Оформление</h3>
        <div class="settings_set">
          {{ form.avatar.label }}
		      <div class="loader">
   			    <div>{{ form.avatar }}</div>
          </div>
          {% if form.avatar.errors %}
            {% for error in avatar_form.avatar.errors %}
              <div style="color: red;">{{ error }}</div>
            {% endfor %}
          {% endif %}
        </div>

        <div class="settings_set">
	 	      {{ form.background.label }}
		      <div class="loader">
   			    <div> {{ form.background }}</div>
    		  </div>
          {% if form.background.errors %}
            {% for error in avatar_form.background.errors %}
              <div style="color: red;">{{ error }}</div>
            {% endfor %}
          {% endif %}
          <span id="instructionBtn" class="fact">Что такое Фон?</span>
          <ol id="instruction" class="instr">
            <p>
              Хотите иметь уникальный фон канала?
              <br>
              Просто создайте картинку с креативно заполненной рамкой (отступ 15%).
            </p>
          </ol>
        </div>

        <div clss="settings_set">
          <h6>Изменить палитру канала</h6>
          <br>
          <div class="settings_set__left">{{ form.color1.label }}</div>
          {{ form.color1(placeholder=usr.get_colors()[0])}}
          <br>
          <div class="settings_set__left">{{ form.color2.label }}</div>
          {{ form.color2(placeholder=usr.get_colors()[1])}}
          <br>
          <div class="settings_set__left">{{ form.colorTxt.label }}</div>
          {{ form.colorTxt(placeholder=usr.get_colors()[2])}}
          <br>
          <div class="settings_set__left">{{ form.colorBrd.label }}</div>
          {{ form.colorBrd(placeholder=usr.get_colors()[3])}}
          <br>
          <div class="settings_set__left">{{ form.colorLink.label }}</div>
          {{ form.colorLink(placeholder=usr.get_colors()[4])}}
        </div>
        <hr>
        <div class="settings_set">
          <b>
          {{ form.current_password.label }}
          {{ form.current_password }}
          {% if form.current_password.errors %}
            {% for error in form.current_password.errors %}
              <div style="color: red;">{{ error }}</div>
            {% endfor %}
          {% endif %}
          </b>
        </div>
        <div class="settings_set">
          <input type="submit" class="buttondlc" value="Сохранить">
        </div>

      </form>
    </div>
  {% endif %}
</div>
<style>
    body
    {
        background-image:url({{ usr.background_url() }});
      	background-size:100% 100%;
    }

    {% if usr.get_colors()[0] %}
    .mid-head,.nav-menu_nav-men__sub-btn,.searcher
    {
      background-color:{{'rgb('+usr.get_colors()[0]+')'}};
    }
    .solid
    {
      background-color:{{'rgba('+usr.get_colors()[0]+',0.85)'}};
    }
    .settings
    {
      background-color:{{'rgba('+usr.get_colors()[0]+',0.7)'}};
    }
    {%endif%}

    {% if usr.get_colors()[1] %}
    .canal
    {
      background-color: {{'rgba('+usr.get_colors()[1]+',0.8)'}};
    }
    textarea,input[type="submit"]:hover
    {
      background-color: {{'rgba('+usr.get_colors()[1]+',0.5)'}};
    }
    .nav-menu_nav-men:hover
    {
      background-color: {{'rgba('+usr.get_colors()[1]+',0.4)'}};
    }
    input,input[type="submit"]
    {
      border-bottom: 2px solid {{'rgb('+usr.get_colors()[1]+')'}};
      background-color: {{'rgb('+usr.get_colors()[1]+')'}};
    }
    .nav-menu_nav-men__sub-btn:hover,.searcher_field__checked
    {
      background-color: {{'rgb('+usr.get_colors()[1]+')'}};
    }
    .tabs_tab__open
    {
      border-bottom: 4px solid {{'rgb('+usr.get_colors()[1]+')'}};
    }
    @media (max-width:570px)
    {
      .nav-menu_nav-men
      {
        border-bottom:1px solid {{'rgba('+usr.get_colors()[1]+',0.5)'}};
      }
    }
    {%endif%}

    {% if usr.get_colors()[2] %}
    .nav-menu_nav-men,body,.nav-menu_nav-men__sub-btn,input,textarea,input[type="submit"]:hover,.searcher_field:hover,.searcher_field__checked
    {
      color: {{'rgb('+usr.get_colors()[2]+')'}};
    }
    {%endif%}

    {% if usr.get_colors()[3] %}
    .nav-menu_nav-men__up-down
    {
      display: none;
    }
    .mid-head
    {
      border-bottom: 2px solid {{'rgba('+usr.get_colors()[3]+',0.5)'}};
    }
    .footer__line,.nav-menu_nav-men:hover
    {
      border-bottom: 2px solid {{'rgb('+usr.get_colors()[3]+')'}};
    }
    .nav-menu_nav-men__upst
    {
      border-top: 2px solid {{'rgb('+usr.get_colors()[3]+')'}};
    }
    .nav-menu_nav-men
    {
      border-right: 1px solid {{'rgba('+usr.get_colors()[3]+',0.5)'}};
    }
    .nav-menu_nav-men__sub-btn
    {
      border-bottom: 1px solid {{'rgba('+usr.get_colors()[3]+',0.5)'}};
    }
    @media (max-width:1065px)
    {
      .nav-menu
      {
        border-top:2px solid {{'rgba('+usr.get_colors()[3]+',0.5)'}};
      }
    }
    {%endif%}

    {% if usr.get_colors()[4] %}
    .fact,a,a:hover,.fact:hover
    {
      color: {{'rgb('+usr.get_colors()[4]+')'}};
    }
    {%endif%}
    @media (max-width:570px)
    {
      body
      {
        background-size: auto;
      }
    }
</style>
<script>
    'use strict';

    function func(a){
        let x;
        let amas = document.getElementsByClassName('tabs_tab');
        for (let i=0; i<amas.length; i++){
            amas[i].classList.remove('tabs_tab__open');
            amas[i].classList.add('tabs_tab');
        }
        a.classList.add('tabs_tab__open');
        let acon = document.getElementsByClassName('section');
        for (let i=0; i<acon.length; i++){
            acon[i].classList.remove('section__open');
            acon[i].classList.add('section');
            if (amas[i].classList.contains('tabs_tab__open')){
                x = i;
            }
        }
        acon[x].classList.add('section__open');
    }

    $(document).ready(function(){
        $("#instructionBtn").click(function(){
        $("#instruction").slideToggle("slow",function(){});
    });});

    var color1Inp=$("#color1");
    var color2Inp=$("#color2");
    var colorTxtInp=$("#colorTxt");
    var colorBrdInp=$("#colorBrd");
    var colorLinkInp=$("#colorLink");
    color1Inp.blur(function()
    {
      $('.midHead').css('background-color','rgb('+color1Inp.val()+')');
      $('.Searcher').css('background-color','rgb('+color1Inp.val()+')');
      $('.subBtn').css('background-color','rgb('+color1Inp.val()+')');
      $('.solid').css('background-color','rgb('+color1Inp.val()+')');
      $('.Settings').css('background-color','rgba('+color1Inp.val()+',0.7)');
    })
    color2Inp.blur(function()
    {
      $('.Canal').css('background-color','rgba('+color2Inp.val()+',0.8)');
      $('.z2').css('border-bottom','4px solid rgb('+color2Inp.val()+')');
      $('input').css('background-color','rgba('+color2Inp.val()+',0.5)');
      $('textarea').css('background-color','rgba('+color2Inp.val()+',0.5)');
      $('.Checked').css('background-color','rgb('+color2Inp.val()+')');
      $('input').css('border-bottom','2px solid rgb('+color2Inp.val()+')');
      $(".navMen").hover(function() {
        $(this).css("background-color",'rgba('+color2Inp.val()+',0.4)')
      });
      $(".subBtn").hover(function() {
        $(this).css("background-color",'rgb('+color2Inp.val()+')')
      });
    })
    colorTxtInp.blur(function()
    {
      $('#Body').css('color','rgb('+colorTxtInp.val()+')');
      $('.navMen').css('color','rgb('+colorTxtInp.val()+')');
    })
    colorBrdInp.blur(function()
    {
      $('.midHead').css('border-bottom','2px solid rgba('+colorBrdInp.val()+',0.5)');
      $('.footLine').css('border-bottom','2px solid rgb('+colorBrdInp.val()+')');
      $('.navMen').css('border-right','1px solid rgba('+colorBrdInp.val()+',0.5)');
      $(".navMen").hover(function() {
        $(this).css("border-bottom",'2px solid rgb('+colorBrdInp.val()+')')
      });
    })
    colorLinkInp.blur(function()
    {
      $('a').css('color','rgb('+colorLinkInp.val()+')');
      $('.Fact').css('color','rgb('+colorLinkInp.val()+')');
    })
</script>
 {% endblock %}
