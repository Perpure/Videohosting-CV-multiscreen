{% extends "base.html" %}
{% block content %}
<h1>Комната {{room.token}}</h1>
{% if room.capitan_id == user.id %}
{% if room.color_user %}
<h4>Upload calibrating image</h4>
<form action="" method="post" enctype="multipart/form-data">
    <div class="Loader"><div> {{ image_form.image }} </div></div>
    <div> {{ image_form.submit }} </div>
</form>
<form action="" method="post">
    {{Room_Form.hidden_tag()}}
    <a href="{{calibrate_url}}">{{ Room_Form.submit }}</a>
</form>
<p><a href="{{result_url}}">result</a>
<hr>
{%else%}
<p>Пригласите участников в комнату
<hr>
{% endif %}
{% endif %}
{% for i in users %}
<p>{{i.login}}</p>
{% endfor %}
{% if room.capitan_id != user.id %}
    <script>
        let speed=3000;
        setTimeout(function step(){
            $.ajax({
                       url:"/askAct",
                       type:"GET",
                       dataType:"text",
                       success:function(response)
                       {
                            if(response=="calibrate")window.location ="{{calibrate_url}}";
                       },
                       error:function(){}
                    });
            setTimeout(step,speed);
        },speed);

        $(function() {
            $(document).ready(function() {
            var width = screen.width;
            var height = screen.height;
                $.ajax({
                  url: '/tellRes',
                  contentType: "application/json; charset=utf-8",
                  type: "POST",
                  data: JSON.stringify({ "width": width, "height" : height }),
                  success: function () {
                    console.log(JSON.stringify({ "width": width, "height" : height }));},
                  });
                  dataType:"json"
            });
        });
    </script>
{% endif %}
{% endblock %}
