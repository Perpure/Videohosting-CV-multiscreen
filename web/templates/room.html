{% extends "base.html" %}
{% block content %}
<h1>Комната {{room.name}}</h1>
<div class="video-control">
  {% if count > 1 %}
    <h5>Количество участников: <span id="countUsers">{{count}}</span></h5>
  {% else %}
    <p id="countUsers">Пригласите участников в комнату</p>
  {% endif %}
  {% if room.capitan_id == anon.id %}
    <hr>
    <button id="calibrate_btn" class="video-control_btn ib">Калибровка</button>
    <div class="ib ib__edge">
      <button id="show_res" class="video-control_btn video-control_btn__round ib {% if not room.video_id %}video-control_btn__disabled{% endif %}"><img src="{{ url_for('static', filename='play.png') }}" id="show_res_img" alt="" class="video-control_img"></button>
      <button id="stop_res" class="video-control_btn video-control_btn__round ib {% if not room.video_id %}video-control_btn__disabled{% endif %}"><img src="{{ url_for('static', filename='stop.png') }}" id="stop_res_img" alt="" class="video-control_img"></button>
    </div>
    <button id="refresh_btn" class="video-control_btn ib ib__edge">Обновить устройства</button>
  {% else %}
    <hr>
    <button class="video-control_btn fullscreen-switcher">Перейти в полноэкранный режим</button>
  {% endif %}
</div>
{% if room.capitan_id == anon.id %}
    <h5>Загрузите калибровочное фото</h5>
    <form action="" method="post" enctype="multipart/form-data">
        <div class="loader"><div><input id="image" name="image" type="file" accept="image/*" capture></div></div>
        {% if image_form.image.errors %}
        {% for error in image_form.image.errors %}
            <div style="color: red;">{{ error }}</div>
        {% endfor %}
    {% endif %}
        <div id="Calibr"> {{ image_form.submit }} </div>
        {% if map_ex %}
        {% endif %}
    </form>
{% endif %}

{% if room.capitan_id == anon.id %}
    {% if room.video_id %}
        <hr>
        <div class="video">
          <div class="video_preview">
            <a href="{{ url_for('play', vid=room.video_id) }}">
              <img src="{{url_for('get_image', pid=room.video_id)}}" alt="" class="video_preview-img">
            </a>
          </div>
        </div>
        <form action="{{url_for('choose_video', room_id=room.id)}}">
            <button>Выбрать другое видео для демонстрации</button>
        </form>
    {% else %}
        <hr>
        <form action="{{url_for('choose_video', room_id=room.id)}}">
            <button>Выберите видео для демонстрации</button>
        </form>
    {% endif %}
    <hr>
{% endif %}

{% if map_ex %}
    <hr>
    <img src="{{url_for('get_multi', pid=room_map)}}" style="width:100%">
{% endif %}

{% if msg %}
    <hr>
    <p>{{msg}}</p>
{% endif %}

<span id="instructionBtn" class="fact">Инструкция</span>
<ol id="instruction" class="instr">
    <li>Пригласите участников.</li>
    <li>Выберите видео для демонстрации.</li>
    <li>Разместите устройства на площади для показа.</li>
    <li>Капитан нажимает на кнопку “Калибровка”.<br>
    4.1. На устройствах участников откроется сплошная цветниая заливка.</li>
    <li>Капитан делает фотографию утсройств и нажимает “Инициализировать”</li>
    <li>Через некоторое время появится карта устройств.<br>
    6.1. Если положение устройств определено неверно повторите действия описанные в п.5</li>
    <li>Капитан нажимает “Начать демонстрацию”</li>
    <li>Начинается показ видео.</li>
</ol>

{% if room.capitan_id != anon.id %}
    {% if room.video_id %}
        <video class="result-video" preload="auto" src="{{url_for('get_video', vid=room.video_id)}}" id="ReVi"></video>
    {% endif %}
{% endif %}
<script src="{{ url_for('static', filename='js/multiscreen/fullscreen.js') }}"></script>
<script src="{{ url_for('static', filename='js/multiscreen/common.js') }}"></script>
<script>
    var ROOM_ID = {{ room.id }};
    var ROOM_COLOR = '{{ color }}';
</script>
{% if room.capitan_id == anon.id %}
    <script src="{{ url_for('static', filename='js/multiscreen/captain.js') }}"></script>
{% else %}
    <script src="{{ url_for('static', filename='js/multiscreen/user.js') }}"></script>
{% endif %}
{% endblock %}
